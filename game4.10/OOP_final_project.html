<meta charset="UTF-8">


<h1>物件導向程式設計實習-書面報告</h1>
<p>組別: 第1組</p>
<p>題目: Typing Typing</p>
<p>組員: 余鎧企 104590020, 黃省喬 104590029</p>
<p>指導老師: 陳偉凱</p>

<ol style="list-style-type: cjk-ideographic;">
  <li>簡介</li>
  <ol>
    <li>動機</li>
    <p>剛學習電腦的時候，打字必為入門基礎。尤其在資工系這塊領域，若打字速度跟不上腦袋思考，必定會錯過許多新穎的想法。而我們在這片學海無涯的道路上，開始了我們的根基。自幼時開始學習英打，接觸過許多網絡上的軟件。有文章式、逐行式、單字類，但因為內容太過於單調與呆版，不受我們的喜愛與大眾的需求。在一個偶然的機遇下，我們找到了「ZType」！，儘管同樣是一個英打練習的網頁，與眾不同的是，它以「遊戲」的方式來進行，既有傳統的計算速度與正確率，又有新穎的華麗特效，成功吸引了初學者的目光。為了攻略這個遊戲、我們夜以繼日的練習。而後，我們英打獲得突飛猛進的突破。而當我們修完上學期的”物件導向程式設計”後，便充分的利用所學，想要在這學期實現出這個令我們曾經感動的遊戲。藉由我們的實作，帶給其他想學打字的人一條有效的途徑，並提供給玩家前所未有聽覺及視覺的雙重響宴。</p>
    <li>分工</li>
    <ul>
      <li>余鎧企</li>
      <p>程式碼撰寫：檔案(File)讀寫處理、紀錄(Record)相關保存、音效(Audio)素材蒐集與處理、魔王(Boss)構思。</p>
      <li>黃省喬</li>
      <p>程式碼撰寫：主角(Me)設計、怪物(Enemy)相關技術、特效處理、選單(List)頁面撰寫。</p>
      <p>美術介面：選單頁面設計、主角皮膚(Skin)、關卡切換特效、遊戲特效設計。</p>
    </ul>
  </ol>１
  <li>遊戲介紹</li>
  <ol>
    <li>遊戲說明</li>
    <p>敵人們正從天而降！趕緊鍵入怪物身上的單字來消滅他們！123456</p>
    <ul>
      <li>玩法</li>
      <p>在本遊戲中有各種不同外貌的敵人(Enemy)，但是他們都有一個共同點，那就是他們的身上都帶著一組英文單字。玩家必須在敵人接近之前，輸入其身上的單字，才能成功的把的敵人消滅。</p>
      <li>規則</li>
      <p>當玩家鎖定攻擊了其中一隻怪物，正輸入到一半的時候，必須繼續將其單字輸入完畢，改敵人被消滅之後，才可以再鎖定其他敵人攻擊。</p>
      <li>敵人</li>
      <p>本遊戲除了普通的敵人外，另外還有多種強大的Boss，除了字數較長外，還各自擁有不同的技能。</p>
      <ul>
        <li>普通敵人(Enemy)</li>
        <p>普通的敵人，會以正常速度從天而降。</p>
        <li>Boss A</li>
        <p>技能：在消滅此Boss之前，他會每間隔一段時間，召喚出一隻普通敵人。</p>
        <li>Boss B</li>
        <p>技能：在消滅此Boss之前，他會每間隔一段時間，召喚多隻字數為1的敵人，以扇狀的方式朝遠方發射。</p>
      </ul>
      <li>特殊功能</li>
      <p>當身邊有太多敵人即將接近，而且來不及將他們消滅的時候，玩家在每場遊戲，有三次的機會可以使用技能。按下"Enter"釋放出電磁脈衝(EMP)，快速的將身邊的敵人消滅。</p>
      <li>密技</li>
      <p>...</p>
    </ul>
    <li>遊戲圖形</li>
    <ul>
      <li>敵人</li>
      <li>BOSS</li>
      <li>角色</li>
      <li>選單及界面</li>
      <ul>
        <li>開頭選單</li>
        <li>遊戲說明頁面</li>
        <li>角色選擇頁面</li>
        <li>統計頁面</li>
        <li>關於頁面</li>
        <li>關卡切換的動畫</li>
        <li>Gameover結算畫面</li>
        <li>遊戲暫停</li>
        <li>背景音樂(BGM)及音效(SE)開關</li>
      </ul>
    </ul>

    <li>遊戲音效</li>
    <ul>
      <li>遊戲背景音樂</li>
      <p>取自於YouTube音樂庫中的The_Coming_Storm，營造出緊張刺激的感覺，提升遊玩上的好感度與刺激性。</p>
      <li>正確按鍵音效</li>
      <p>輸入正確的按鍵，會發出酷似手槍射擊的聲音，讓使用者在遊玩上獲得激勵</p>
      <li>錯誤按鍵音效</li>
      <p>若輸入錯誤，則會發出「喀喀喀」的音效，提醒使用者請勿盲目地亂敲鍵盤</p>
      <li>EMP(電磁脈衝)音效</li>
      <p>利用「爆炸」的音效，令使用者在狗急跳牆之際得以獲得一絲喘息空間。</p>
      <li>GameOver音效</li>
      <p>除了提醒使用者遊戲結束，利用詼諧逗趣的音樂，令使用者想再重新來過，提升自我實力！</p>

    </ul>
  </ol>
  <li>程式設計</li>
  <ol>
    <li>程式架構</li>
    <li>程式類別</li>
    <table style="border: 1px solid #333;">
      <tr>
        <td>類別名稱</td>
        <td>.h 檔行數</td>
        <td>.cpp 檔行數</td>
        <td>說明</td>
      </tr>
      <tr>
        <td>CEnemy</td>
        <td>65</td>
        <td>205</td>
        <td>普通敵人，會朝特定方向飛行。</td>
      </tr>
      <tr>
        <td>CBossA</td>
        <td>15</td>
        <td>92</td>
        <td>魔王A，每隔一段時間會召喚一隻Enemy。</td>
      </tr>
      <tr>
        <td>CBossB</td>
        <td>12</td>
        <td>104</td>
        <td>魔王B，每隔一段時間會以扇狀的方式召喚多隻字數為1的Enemy。</td>
      </tr>
      <tr>
        <td>CEmp</td>
        <td>39</td>
        <td>139</td>
        <td>電磁脈衝，使用後會依照動畫清除範圍內的Enemy</td>
      </tr>
      <tr>
        <td>CBullet</td>
        <td>25</td>
        <td>71</td>
        <td>子彈，從主角的位置不偏不倚地射向敵人。</td>
      </tr>
      <tr>
        <td>CBomb</td>
        <td>23</td>
        <td>55</td>
        <td>爆炸效果，當敵人死亡時便會顯示此效果。</td>
      </tr>

      <tr>
        <td>CMe</td>
        <td>52</td>
        <td>345</td>
        <td>顯示主角的圖樣，在三個遊戲狀態中皆會以不同的形式出現。</td>
      </tr>
      <tr>
        <td>CCharacter</td>
        <td>31</td>
        <td>94</td>
        <td>記錄主角的屬性：外觀與解鎖條件。</td>
      </tr>
      <tr>
        <td>CFile</td>
        <td>67</td>
        <td>262</td>
        <td>記錄遊戲結果，可以讀寫TXT檔，用以儲存最高記錄、每場遊玩記錄及選擇的角色等。</td>
      </tr>
      <tr>
        <td>CRecord</td>
        <td>33</td>
        <td>53</td>
        <td>顯示每場遊玩記錄時，用來儲存每筆資料裡面的分數、關卡、按鍵數、正確率及角色。</td>
      </tr>
      <tr>
        <td>CMap</td>
        <td>24</td>
        <td>58</td>
        <td>在遊戲畫面顯示持續移動的網狀背景。</td>
      </tr>
      <tr>
        <td>CDict</td>
        <td>14</td>
        <td>46</td>
        <td>字典檔，用於讀取txt文字檔中的單字，並儲存於vector。</td>
      </tr>
      <tr>
        <td>CLevel</td>
        <td>27</td>
        <td>115</td>
        <td>遊戲內中的換關動畫。</td>
      </tr>
      <tr>
        <td>myGame</td>
        <td>194</td>
        <td>1261</td>
        <td>遊戲程式碼本身，概括分為：遊戲開始、遊戲進行中、遊戲結束下去著墨、延伸</td>
      </tr>
      <tr>
        <td>總行數</td>
        <td>618</td>
        <td>2900</td>
        <td></td>
      </tr>
    </table>
    <li>程式技術</li>
    <ul>
      <li>亂樹種子(Rand)</li>
      <p>我們利用系統時間產生亂數，令敵人落下時的位置具有隨機性。但因為美術圖外型的關係，所以我們以預防了會友跑出畫面外的狀況。</p>
      <li>三角函數計算</li>
      <p>在敵人BossB的設計中，我們設定它每隔一段時間便會以扇狀的方式召喚一群小怪，而在扇狀的計算中， 我們利用了角度與徑度的換算、二維座標定位採取極座標之運算，利用迴圈與變數，讓就算有再多的小怪，也可以精確地計算出位置， 但考慮視覺的舒適度與畫面的流暢度，我們最後將小怪定為7隻。</p>
      <li>繼承(Inheriance)</li>
      <p>由於落下的敵人不只是一般的普通小怪，還有難度提升的BossA與較難應付的BossB。在設計的過程中， 我們將BossA繼承原有Enemy，並新增有別與原有Enemy的美術圖與新的時間差，再利用下一項提及的「多型」設計新功能函數。 而BossB更繼承了BossA，設計出了極具巧思的特有功能。
      </p>

      <li>多型(Polymophism)</li>
      <p>在多型方面，我們利用了虛擬函數(Vitual Function)。我們在普通小怪、BossA、BossB上做了明確的區分，但因為是繼承關係， 所以在載入圖片、移動(move)函數與死亡設定(kill)函數上運用了虛擬函數做出獨特性。</p>
      <li>Vector、迭代(Iterator)</li>
      <p>我們採用Vector的方式來存放場上現有的敵人，而非利用Array來儲存，會這麼做的原因有以下考量。使用Vector可以快速的在集合尾端插入資料，而且也支援隨機存取，方便我們可以將已死亡的敵人，從陣列中移除。同時也可以利用.size()函數，很方便的取得當前場上敵人的總數，用來判斷是否可以接到下一關，利用Iterator和迴圈可以從頭到尾尋訪所有的敵人，鎖定特定條件的敵人。</p>
      <li>遊玩記錄之保存</li>
      <p>我們利用了大一所學習的檔案讀寫功能，實作出歷史紀錄的保存，同時我們也讀取出最高分的紀錄，來提供玩家一個超越的指標，同時達到振奮效果。除此之外我們也未忽略使用者的遊玩體驗，在小細節上，遊戲也會記錄下玩家上次遊玩所選擇的角色及音效的開關狀態，下次開啟遊戲時，即可保留玩家的使用習性。</p>
      <li>作弊(Cheat)、除錯(Debug)功能</li>
      <p>在「關於」頁面中我們暗藏作弊碼，只要輸入正確即可快速解鎖全角色與開啟Debug的功能。Debug功能中，我們利用快捷鍵即可開啟顯示怪物列表及狀態，與快速清除怪物。在遊戲狀態的操作上，我們實作出自由進出State，可以加快我們遊戲處理速度。</p>

    </ul>

  </ol>
  <li>結語</li>
  <ol>
    <li>問題及解決方法</li>
    <ol>
      <li>在利用vector.size()來跑For迴圈時，出現"將警告視為錯誤處理 - 沒有產生 'object' 檔案"之錯誤</li>
      <p>以vector.size()，它回傳的值是unsigned int，而平時撰寫程式時，通常習慣直接使用int來宣告i，然而此framework對於形態的規則比較嚴格，因此他將int和unsigned int視為不同的東西，因此只需要將變數i設定成unsigned int即可排除此錯誤。</p>
      <li>利用CDC螢幕字形來顯示怪物身上的單字，當怪物數量變多時，遊戲會嚴重卡頓。</li>
      <p>原本遇到這個問題時，還不知道為何遊戲執行到後期，會越來越卡頓。後來看到了老師的Framework註解中提到說，盡量不要以此方式顯示文字，而是以CMovingBitmap來取而代之比較好。於是我們該採，將26個英文單字都製作成一個bmp檔，並且研究比對各種不同字體所呈現出來的效果，於是再次執行後果然效率得到大大的改善，執行更為流暢。然而使用Bitmap來顯示文字有個缺點，就是文字的顯示位置必須謹慎拿捏，因為我們是靠迴圈來一個個貼上字母，經過反復的測試才抓到最佳的顯示位置。</p>
      <li>Float與除法運算時，計算結果總不正確</li>
      <p>經過上網查詢資料後，發現float運算時有小陷阱，這個陷阱以前我們未曾留意到，是在計算怪物飛行偏移量dx,dy時才首次發生的。例如計算double x= 3/2;，此預期的結果x應該要等於1.5，然而運算結果總等於1。這是因為算式的3和2都被視為int，因此3/2整體也被看做是一個int。後來發現只要預先將數字或變數強制轉型成double，就可以解決此Bug。如上面例子所示，可以改寫成double x= double(3)/double(2);。若是針對常數運算，也可直接在該整數的後方加上小數點，例如double
        x= 3.0/2.0;，如此一來x也能得到正確的運算結果。</p>
      <li>在KeyDown事件中，明明使用者只按下一次按鈕，但程式實際卻會多執行數次。</li>
      <p>這個Bug有點類似於設計電路時的彈跳，雖然表面上看起來只按下了一次，但程式的Cycle卻是不斷的在跑，這對於我們這種單字消除遊戲是非常困擾的，例如若出現連續字母的單字(BEE)，那在輸入到第2個字母‘E’的時候，會連帶的也把第三個字母‘E’也給消除了。於是我們使用一個字元變數key，來儲存按下的按鍵。每當OnKeyDown被執行時就判斷當前所按下的按鍵是否和key相同，否的話則正常執行並將當前按鍵存入key中。而當OnKeyUp時再將key變數設定為NULL，表示已放開了按鍵。這麼做之後，不僅解決了彈跳的問題，而且若使用者輸入速度過快，同時按下2個按鍵時，程式依然可以正確的判定。</p>
      <li>在三個不同State間，想要共用某些變數</li>
      <p>我們在MyGame裡面額外新增了一個Class，專門儲存共用的變數，ex:檔案(File)的讀寫、角色(Me)的參數、分數(Score)、正確率(Accuracy)等等...，這樣成功的解決在三個Class之間變數的進出。
      </p>
    </ol>

    <li>時間表</li>

    <li>貢獻比例</li>
    <p>黃省喬：60%</p>
    <p>余鎧企：40%</p>
    <li>檢核表</li>
    <table style="border: 1px solid #333;">
      <tr>
        <td></td>
        <td>項目</td>
        <td>完成否</td>
        <td>無法完成的原因</td>
      </tr>
      <tr>
        <td style="width:50px;">1</td>
        <td>解決 Memory leak</td>
        <td>☑︎已完成 □未完成</td>
        <td></td>
      </tr>
      <tr>
        <td>2</td>
        <td>自定遊戲 Icon</td>
        <td>☑︎已完成 □未完成</td>
        <td></td>
      </tr>
      <tr>
        <td>3</td>
        <td>全螢幕啟動</td>
        <td>☑︎已完成 □未完成</td>
        <td></td>
      </tr>
      <tr>
        <td>4</td>
        <td>修改 Help->About</td>
        <td>☑︎已完成 □未完成</td>
        <td></td>
      </tr>
      <tr>
        <td>5</td>
        <td>初始畫面說明按鍵及滑鼠之用法與密技</td>
        <td>☑︎已完成 □未完成</td>
        <td></td>
      </tr>
      <tr>
        <td>6</td>
        <td>上傳 setup 檔</td>
        <td>☑︎已完成 □未完成</td>
        <td></td>
      </tr>
      <tr>
        <td>7</td>
        <td>報告字型、點數、對齊、行 距、頁碼等格式正確</td>
        <td>☑︎已完成 □未完成</td>
        <td></td>
      </tr>
      <tr>
        <td>8</td>
        <td>報告封面、側邊格式正確</td>
        <td>☑︎已完成 □未完成</td>
        <td></td>
      </tr>
    </table>
    <li>收獲</li>
    <ul>
      <li>104590029 黃省喬</li>
      <p>這是我第一次撰寫架構完整的遊戲，對於老師所提供的Framework也很陌生，一切都得憑藉著自己的摸索，才得以慢慢的撥雲見日。而在開發遊戲的過程中，我也得到相當多的收穫，學到很多不同的新知。</p>
      <p>首先在以C＋＋來撰寫遊戲時，和以往的程式作業﹣僅僅透過console視窗來輸入指令進行運算不同。為了使得圖片在畫面中顯示，必須使用OnShow函數；為了使得圖片在畫面中移動，則要使用OnMove函數。這些對我來說都是非常嶄新的概念，這些函數皆各司其職且缺一不可，他們彼此間相輔相成，才造就起遊戲的穩固根基。</p>
      <p>我了解到OnMove函數每秒執行約30次，所以我們便可以利用此特性來設計出各種動畫，如背景網狀的動畫、切換關卡時從上往下滑的提示文字、瞄準怪物時的準星動畫等，除此之外各種判斷的程式大多也在OnMove裡完成，例如搭配計數器(counter)，就可以設計每間隔一段時間便召喚一隻怪物。</p>
      <p>由於我們設計的是“單字消除遊戲”，因此OnKeyDown的事件就顯得格外重要。在開發時我們就遇到了一個問題：在OnKeyDown時，會有類似以前設計電路時按下按鈕時彈跳的窘境。你以為你只按了一下按鍵，但程式的cycle卻是不斷在執行的，所以在按下按鍵到放開按鍵這中間，OnKeyDown可能就被執行了超過10次。為了解決這困擾，我們新增了一個變數key，用於儲存按下的按鍵。每當OnKeyDown被執行時就判斷當前所按下的按鍵是否和key相同，否的話則正常執行並將當前按鍵存入key中。而當OnKeyUp時再將key變數設定為NULL，表示已放開了按鍵。</p>
      <p>所幸有Astyle提供自動排版，讓我們在撰寫程式的過程當中省了不少心，而看到老師提供的Framework，我才驚覺到原來程式碼和註解的對齊也是一門學問，僅有Astyle還不夠，若可以適時善用TAB及倒斜線換行來讓程式碼對齊，那麼對於日後閱讀程式碼可有相當大的助益。</p>
      <p>為了精簡程式碼並使其更易讀，我也學習到在載入Bitmap時，可以善用迴圈及sprintf函數來讀取路徑。例如想要隨機顯示敵人皮膚的Bitmap，我們可以預先將圖檔都編號(faceXX.bmp) ,程式中再搭配sprintf及rand函數隨機載入Bitmap。我認為用這種方法，遠比將所有的路徑儲存於字串陣列中，還來的更有效率。</p>
      <p>因為以往寫的程式執行的時間不會太長，通常輸入完沒幾行指令程式就結束了，基本上都是簡單的運算及文字處理，所以我一直都忽視了記憶體佔用多寡的重要性。而在設計較大型的遊戲時，妥善的記憶體分配之重要性更是不容小覷。為了減少記憶體的浪費，某些常用且經常重複出現的元素，我選擇將它們宣告在mygame的protected之中，再利用指標的方式傳入需要的class中。例如我們有一個字典class叫做CDict，其用途是自txt檔讀取單字字串並存入vector，並可以回傳隨機一個單字。最初我們是在每一隻敵人(CEnemy)裡都獨立宣告一個CDict，但在中期時我們發覺，其實沒必要每new一隻敵人，同時帶著一份笨重的CDict。因為CDict裡的vector儲存了上百筆的字串，隨著敵人的數量增加，想必會對於記憶體造成極大負荷。於是我們採用讓每個敵人都以指標的方式，共用同一個CDict，結果不出所料，原本生成敵人時會有的卡頓感瞬間煙消雲散。</p>
      <p>在vector的運用上，我學到要清空vector前，必須先將內部的資料都delete才行。以下這句金句更是狠狠地烙印我心：“new了什麼就要記得delete什麼。”</p>

    </ul>
    <li>心得、感想</li>
    <ul>
      <li>104590029 黃省喬</li>
      <p>從小到大我接觸了各式不同種類的遊戲，並且從那個時候就對電腦遊戲感到無比的著迷。對於一個好奇心旺盛的少年來說，電腦遊戲為平時枯燥乏味的求學生活帶來無限的溫暖曙光，探索在無垠無涯的虛擬世界裡，樂趣無窮，我想這就是所謂的青春吧。</p>
      <p>當我得知物件導向實習課，是要以寫遊戲來呈現時，其實我是十分興奮的。在經歷上學期OOP課程的洗禮後，我對於物件導向的概念已有初步的認識及瞭解，但若無法將課堂中得到的知識學以致用，那我認為學的再多都是枉然。而這堂OOP實習課，便給了我們這千載難逢的機會，讓我們可以將腦中無數創意想法付諸實際，得以活用程式設計的技巧並增加邏輯推理的能力。</p>
      <p>而以製作遊戲來當做期末專題，對我來說也是相當耳目一新，畢竟玩過了無數大大小小的遊戲，現在卻要換我們來寫出一個遊戲，無疑是一項艱巨的挑戰。但漸漸地，我發現我越來越沉浸於撰寫程式和DEBUG的過程當中，只要是閒暇之餘就會把程式給打開來寫，甚至到了有些廢寢忘食的地步，這真是奇妙的感覺。</p>
      <p>無論是突然的靈光乍現解決了臭蟲，或是編輯素材時，一筆一劃刻畫出的怪物圖片，能憑藉著自己的力量，一步一個腳印的使遊戲壯大，由淺入深的內容變得豐富，看到最終完成的作品，那股成就感是不言而喻的。</p>
      <p>對我來說這不僅僅是一門實習課，除了獲得學分之外，我認為在製作專題的過程中學習到的東西才最難能可貴。在遭遇困難時，懂得利用網路資源尋求解決方案，或是和同學請教互相討論，在如此潛移默化下，我在撰寫程式時的思路變得更加清晰有脈絡，在無形中學到的東西更遠遠超過原本我所期待。</p>
    </ul>
    <li>對於本課程的建議</li>
  </ol>
  <li>附錄</li>

</ol>
